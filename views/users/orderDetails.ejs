<%-include("../layouts/header")    %>
<link href="/assets/css/main.css?v=1.1" rel="stylesheet" type="text/css" />

<!-- Start Banner Area -->
<section class="banner-area organic-breadcrumb">
    <div class="container">
        <div class="breadcrumb-banner d-flex flex-wrap align-items-center justify-content-end">
            <div class="col-first">
                <h1>Orders</h1>
                <nav class="d-flex align-items-center">
                    <a href="">Home<span class="lnr lnr-arrow-right"></span></a>
                    <a href="">Orders</a>
                </nav>
            </div>
        </div>
    </div>
</section>
<!-- End Banner Area -->

<!--================Order Details Area =================-->
<section class="order_details section_gap">
    <div class="container">
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>#ID</th>
                        <th scope="col">Total</th>
                        <th scope="col">Status</th>
                        <th scope="col">Date</th>
                        <th scope="col" class="text-end">Action</th>
                    </tr>
                </thead>
                <tbody>
                    <% orderdetails.reverse().forEach((item)=>{ %>

                    <tr>            
                        <input type="hidden" class="orderIdInput" value="<%= item._id %>">

                        <td><%= item._id %></td>
                        <td><%= item.totalPrice %></td>
                        <td><span class="badge rounded-pill alert-warning"><%= item.orderStatus %></span></td>
                        <td><%= item.createdAt.toLocaleDateString() %></td>
                        <td class="text-end">

                            <a href="/viewItems/<%= item._id %>" class="btn btn-md rounded font-sm">Detail</a>
                        
                        </td>
                        <td>
                            <% if (item.orderStatus === "Pending") { %>
                                <button class="btn btn-md rounded font-sm cancel-btn">Cancel</button>
                            <% } else if(item.orderStatus === "Delivered" ){%>
                                <button class="btn btn-md rounded font-sm return-btn">Return</button>
                            <% } %>
                        </td>
                        
                    </tr>
                   <% }) %>
                    
                </tbody>
            </table>
        </div>        
        
    </div>
</section>
<!--================End Order Details Area =================--><script src="/assets/js/vendors/jquery-3.6.0.min.js"></script>
<script src="/assets/js/vendors/bootstrap.bundle.min.js"></script>
<script src="/assets/js/vendors/select2.min.js"></script>
<script src="/assets/js/vendors/perfect-scrollbar.js"></script>
<script src="/assets/js/vendors/jquery.fullscreen.min.js"></script>
<script src="/assets/js/vendors/chart.js"></script>
<!-- Main Script -->
<script src="/assets/js/main.js?v=1.1" type="text/javascript"></script>
<script src="/assets/js/custom-chart.js" type="text/javascript"></script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        document.querySelectorAll('.cancel-btn').forEach(button => {
            button.addEventListener('click', function () {
                updateOrderStatus(this.closest('tr').querySelector('.orderIdInput').value, 'Cancel');
            });
        });

        document.querySelectorAll('.return-btn').forEach(button => {
            button.addEventListener('click', function () {
                updateOrderStatus(this.closest('tr').querySelector('.orderIdInput').value, 'Return');
            });
        });
    });

    function updateOrderStatus(orderId, status) {
        fetch(`/updateOrderStatus/${orderId}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ status: status })
        })
        .then(response => {
            if (response.ok) {
                console.log('Status updated successfully');
                window.location.reload();
            } else {
                console.error('Failed to update status');
            }
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }
</script>



<%-include("../layouts/footer")    %>